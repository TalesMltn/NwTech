<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle ?: 'Panel Admin - TecMerch'}">Panel Admin</title>
    <!-- Bootstrap + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Data Labels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@latest/dist/chartjs-plugin-datalabels.min.js"></script>
    <!-- Fuente futurista -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <!-- CSS externo -->
    <link rel="stylesheet" href="/css/admin-dashboard.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar (el nuevo limpio que te gustó) -->
        <div class="col-md-3 sidebar">
            <h3 class="text-white mb-5 text-center">
                <i class="bi bi-speedometer2 me-2"></i> Admin Panel
            </h3>
            <nav class="nav flex-column">
                <a class="nav-link active" href="/admin/dashboard">
                    <i class="bi bi-speedometer2 me-2"></i> Dashboard
                </a>
                <a class="nav-link" href="/admin/categorias">
                    <i class="bi bi-grid-3x3-gap me-2"></i> Categorías
                </a>
                <a class="nav-link" href="/admin/productos">
                    <i class="bi bi-box-seam me-2"></i> Productos
                </a>
                <a class="nav-link" href="/admin/citas">
                    <i class="bi bi-calendar-check me-2"></i> Citas Técnicas
                </a>
                <a class="nav-link" href="/admin/contactos">
                    <i class="bi bi-envelope me-2"></i> Contactos / Cotizaciones
                </a>
            </nav>
            <hr class="border-secondary my-5">
            <a th:href="@{/logout}" class="nav-link text-danger">
                <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión
            </a>
        </div>

        <!-- Contenido principal -->
        <div class="col-md-9 main-content">
            <h1>Panel de Control - TecMerch</h1>

            <!-- Métricas principales -->
            <div class="row text-center mb-5 g-4">
                <div class="col">
                    <i class="bi bi-currency-dollar icon-metric"></i>
                    <div class="metric-number">S/ 42,000</div>
                    <div class="metric-label">Ventas Anuales</div>
                </div>
                <div class="col">
                    <i class="bi bi-graph-up-arrow icon-metric"></i>
                    <div class="metric-number">+28%</div>
                    <div class="metric-label">Crecimiento</div>
                </div>
                <div class="col">
                    <i class="bi bi-hand-thumbs-up-fill icon-metric"></i>
                    <div class="metric-number">92%</div>
                    <div class="metric-label">Satisfacción</div>
                </div>
                <div class="col">
                    <i class="bi bi-lightbulb-fill icon-metric"></i>
                    <div class="metric-number">156</div>
                    <div class="metric-label">Productos</div>
                </div>
                <div class="col">
                    <i class="bi bi-clock-history icon-metric"></i>
                    <div class="metric-number">24/7</div>
                    <div class="metric-label">Soporte</div>
                </div>
            </div>

            <!-- Gráficos -->
            <div class="row g-4">
                <!-- Ventas por Categoría -->
                <div class="col-md-6">
                    <div class="card">
                        <h5>Ventas por Categoría</h5>
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
                <!-- Tendencia Anual (Mensual) -->
                <div class="col-md-6">
                    <div class="card">
                        <h5>Ventas Mensuales 2025</h5>
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row g-4 mt-4">
                <!-- Ventas Diarias del Mes Actual (Nuevo, más grande) -->
                <div class="col-md-12">
                    <div class="card">
                        <h5>Ventas Diarias - Diciembre 2025</h5>
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Registrar el plugin de datalabels globalmente
    Chart.register(ChartDataLabels);

    // 1. Ventas por Categoría
    new Chart('barChart', {
        type: 'bar',
        data: {
            labels: ['Laptops', 'PCs', 'Periféricos Gaming', 'Accesorios'],
            datasets: [{
                data: [3709, 3647, 6887, 4255],
                backgroundColor: ['#60a5fa', '#818cf8', '#a78bfa', '#c4b5fd']
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, grid: { color: 'rgba(96,165,250,0.2)' } } }
        }
    });

    // 2. Ventas Diarias del Mes Actual (Diciembre 2025 - 31 días)
    new Chart('dailyChart', {
        type: 'bar',
        data: {
            labels: ['1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31'],
            datasets: [{
                label: 'Ventas Diarias (S/)',
                data: [1450, 1680, 1520, 1890, 2100, 1750, 1980, 1620, 1850, 2020, 1780, 1950, 2150, 1880, 1720, 2250, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                backgroundColor: '#60a5fa',
                borderColor: '#3b82f6',
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                legend: { display: false },
                datalabels: {
                    anchor: 'end',
                    align: 'end',
                    color: '#ffffff',
                    font: {
                        size: 12,
                        weight: 'bold'
                    },
                    formatter: function(value) {
                        return value > 0 ? 'S/ ' + value : '';
                    }
                }
            },
            scales: {
                y: { beginAtZero: true, grid: { color: 'rgba(96,165,250,0.2)' } },
                x: { grid: { display: false } }
            }
        }
    });

    // 3. Ventas Mensuales del Año 2025
    new Chart('lineChart', {
        type: 'line',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            datasets: [{
                label: 'Ventas Mensuales (S/)',
                data: [12000, 19000, 15000, 25000, 22000, 32450, 28000, 31000, 29000, 35000, 38000, 42000],
                borderColor: '#60a5fa',
                backgroundColor: 'rgba(96,165,250,0.2)',
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#60a5fa',
                pointRadius: 5
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, grid: { color: 'rgba(96,165,250,0.2)' } },
                x: { grid: { color: 'rgba(96,165,250,0.2)' } }
            }
        }
    });
</script>
</body>
</html>